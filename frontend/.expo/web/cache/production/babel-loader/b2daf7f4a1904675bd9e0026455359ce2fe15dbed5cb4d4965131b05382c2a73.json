{"ast":null,"code":"import React from'react';import View from\"react-native-web/dist/exports/View\";import FlatList from\"react-native-web/dist/exports/FlatList\";import Text from\"react-native-web/dist/exports/Text\";import SafeAreaView from\"react-native-web/dist/exports/SafeAreaView\";import{styles}from'../styles/screens/FeedScreen';import{FloatingButton}from'./FloatingButton';import Post from'./Post';import AsyncStorage from\"@react-native-async-storage/async-storage\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default class SuperScrollList extends React.Component{navigation=null;loader=null;constructor(props){super(props);this.navigation=props.navigation;this.loader=props.loader;this.state={data:[],page:1,isLoading:false,hasMore:true};this.flatListRef=React.createRef();}componentDidMount(){this.loader&&this.fetchData().then(()=>console.log(\"Fetched data!\"));}fetchData=async()=>{if(this.state.isLoading||!this.state.hasMore)return;this.setState({isLoading:true});try{const res=await this.loader(this.state.page);const newPosts=res.posts||[];this.setState(prevState=>({data:prevState.page===1?newPosts:[...prevState.data,...newPosts],isLoading:false,hasMore:newPosts.length>0}));}catch(error){console.error('Error fetching posts:',error);if(error.message===\"{\\\"error\\\":\\\"Access denied, no valid Bearer token provided\\\"}\"){this.navigation.replace('Login');await AsyncStorage.removeItem('token');}this.setState({isLoading:false});}};handleLoadMore=()=>{if(!this.state.isLoading&&this.state.hasMore){this.setState(prevState=>({page:prevState.page+1}),()=>this.fetchData());}};handleScroll=event=>{const{contentOffset,contentSize,layoutMeasurement}=event.nativeEvent;const distanceFromBottom=contentSize.height-contentOffset.y-layoutMeasurement.height;};renderRow=({item})=>{return _jsxs(View,{style:{minHeight:50},children:[\" \",_jsx(Post,{post:item,navigation:this.navigation})]});};renderList=()=>{return _jsx(FlatList,{ref:this.flatListRef,data:this.state.data,renderItem:this.renderRow,keyExtractor:(item,index)=>item.id?item.id.toString():index.toString(),onEndReached:this.handleLoadMore,onEndReachedThreshold:0.1,style:{backgroundColor:\"#000\",flex:1,alignSelf:'center'},onScroll:this.handleScroll,ListFooterComponent:this.renderFooter,showsVerticalScrollIndicator:false,contentContainerStyle:{flexGrow:1},extraData:this.state.page});};renderFooter=()=>{if(!this.state.isLoading)return null;return _jsx(View,{style:{padding:20},children:_jsx(Text,{children:\"Loading more posts...\"})});};renderEmpty=()=>{if(this.state.isLoading)return null;return _jsx(View,{style:{flex:1,justifyContent:'center',alignItems:'center'},children:_jsx(Text,{children:\"No posts available\"})});};render(){return _jsxs(SafeAreaView,{style:[styles.container,{backgroundColor:\"#000\"}],children:[this.state.data.length===0?this.renderEmpty():this.renderList(),_jsx(FloatingButton,{onPress:()=>this.navigation.navigate('CreatePost'),visible:true})]});}}","map":{"version":3,"names":["React","View","FlatList","Text","SafeAreaView","styles","FloatingButton","Post","AsyncStorage","jsx","_jsx","jsxs","_jsxs","SuperScrollList","Component","navigation","loader","constructor","props","state","data","page","isLoading","hasMore","flatListRef","createRef","componentDidMount","fetchData","then","console","log","setState","res","newPosts","posts","prevState","length","error","message","replace","removeItem","handleLoadMore","handleScroll","event","contentOffset","contentSize","layoutMeasurement","nativeEvent","distanceFromBottom","height","y","renderRow","item","style","minHeight","children","post","renderList","ref","renderItem","keyExtractor","index","id","toString","onEndReached","onEndReachedThreshold","backgroundColor","flex","alignSelf","onScroll","ListFooterComponent","renderFooter","showsVerticalScrollIndicator","contentContainerStyle","flexGrow","extraData","padding","renderEmpty","justifyContent","alignItems","render","container","onPress","navigate","visible"],"sources":["/Users/deu/SigmaLTD/frontend/components/SuperScrollList.js"],"sourcesContent":["import React from 'react';\nimport {\n    View,\n    FlatList,\n    Text,\n    SafeAreaView,\n} from 'react-native';\nimport {styles} from '../styles/screens/FeedScreen';\nimport {FloatingButton} from './FloatingButton';\nimport Post from './Post';\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\n\nexport default class SuperScrollList extends React.Component {\n    navigation = null;\n    loader = null;\n    constructor(props) {\n        super(props);\n        this.navigation = props.navigation;\n        this.loader = props.loader;\n        this.state = {\n            data: [],\n            page: 1,\n            isLoading: false,\n            hasMore: true,\n        };\n        this.flatListRef = React.createRef();\n    }\n\n    componentDidMount() {\n        (this.loader && this.fetchData().then(() => console.log(\"Fetched data!\")));\n    }\n\n    fetchData = async () => {\n        if (this.state.isLoading || !this.state.hasMore) return;\n\n        this.setState({isLoading: true});\n        try {\n            const res = await this.loader(this.state.page);\n            const newPosts = res.posts || [];\n\n            this.setState(prevState => ({\n                data: prevState.page === 1 ? newPosts : [...prevState.data, ...newPosts],\n                isLoading: false,\n                hasMore: newPosts.length > 0\n            }));\n        } catch (error) {\n            console.error('Error fetching posts:', error);\n            if (error.message === \"{\\\"error\\\":\\\"Access denied, no valid Bearer token provided\\\"}\") {\n                this.navigation.replace('Login');\n                await AsyncStorage.removeItem('token');\n            }\n            this.setState({isLoading: false});\n        }\n    };\n\n    handleLoadMore = () => {\n        if (!this.state.isLoading && this.state.hasMore) {\n            this.setState(\n                prevState => ({page: prevState.page + 1}),\n                () => this.fetchData()\n            );\n        }\n    };\n\n    // Add this to debug scroll position\n    handleScroll = (event) => {\n        const {contentOffset, contentSize, layoutMeasurement} = event.nativeEvent;\n        const distanceFromBottom = contentSize.height - contentOffset.y - layoutMeasurement.height;\n    };\n\n    renderRow = ({item}) => {\n        return (\n            <View style={{minHeight: 50}}> {/* Ensure items have minimum height */}\n                <Post post={item} navigation={this.navigation} />\n            </View>\n        );\n    };\n\n    renderList = () => {\n        return (\n            <FlatList\n                ref={this.flatListRef}\n                data={this.state.data}\n                renderItem={this.renderRow}\n                keyExtractor={(item, index) => item.id ? item.id.toString() : index.toString()}\n                onEndReached={this.handleLoadMore}\n                onEndReachedThreshold={0.1}\n                style={{backgroundColor: \"#000\", flex: 1, alignSelf: 'center'}}\n                onScroll={this.handleScroll} // Add scroll debugging\n                ListFooterComponent={this.renderFooter}\n                showsVerticalScrollIndicator={false} // Make scroll indicator visible for debugging\n                contentContainerStyle={{flexGrow: 1}} // Ensure content takes up space\n                extraData={this.state.page} // Force re-render on page change\n            />\n        );\n    };\n\n    renderFooter = () => {\n        if (!this.state.isLoading) return null;\n        return (\n            <View style={{padding: 20}}>\n                <Text>Loading more posts...</Text>\n            </View>\n        );\n    };\n\n    renderEmpty = () => {\n        if (this.state.isLoading) return null;\n        return (\n            <View style={{flex: 1, justifyContent: 'center', alignItems: 'center'}}>\n                <Text>No posts available</Text>\n            </View>\n        );\n    };\n\n    render() {\n        return (\n            <SafeAreaView style={[styles.container, {backgroundColor: \"#000\"}]}>\n                {this.state.data.length === 0 ? this.renderEmpty() : this.renderList()}\n                <FloatingButton\n                    onPress={() => this.navigation.navigate('CreatePost')}\n                    visible={true}\n                />\n            </SafeAreaView>\n        );\n    }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{"hasCjsExports":false},"sourceType":"module","externalDependencies":[]}