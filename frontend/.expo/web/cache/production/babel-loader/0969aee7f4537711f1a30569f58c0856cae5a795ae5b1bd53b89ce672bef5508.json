{"ast":null,"code":"import{SharedObject}from'expo';import ImageManipulatorImageRef from'./ImageManipulatorImageRef.web';import{crop,extent,flip,resize,rotate}from'./actions/index.web';export default class ImageManipulatorContext extends SharedObject{constructor(loader){super();this.loader=loader??(()=>document.createElement('canvas'));this.currentTask=new Promise(resolve=>resolve(this.loader()));}resize(size){return this.addTask(canvas=>resize(canvas,size));}rotate(degrees){return this.addTask(canvas=>rotate(canvas,degrees));}flip(flipType){return this.addTask(canvas=>flip(canvas,flipType));}crop(rect){return this.addTask(canvas=>crop(canvas,rect));}extent(options){return this.addTask(canvas=>extent(canvas,options));}reset(){this.currentTask=new Promise(resolve=>resolve(this.loader()));return this;}async renderAsync(){const canvas=await this.currentTask;return new Promise(resolve=>{canvas.toBlob(blob=>{const url=blob?URL.createObjectURL(blob):canvas.toDataURL();resolve(new ImageManipulatorImageRef(url,canvas.width,canvas.height));});});}addTask(task){this.currentTask=this.currentTask.then(canvas=>{return task(canvas);});return this;}}","map":{"version":3,"names":["SharedObject","ImageManipulatorImageRef","crop","extent","flip","resize","rotate","ImageManipulatorContext","constructor","loader","document","createElement","currentTask","Promise","resolve","size","addTask","canvas","degrees","flipType","rect","options","reset","renderAsync","toBlob","blob","url","URL","createObjectURL","toDataURL","width","height","task","then"],"sources":["/Users/deu/SigmaLTD/frontend/node_modules/expo-image-manipulator/src/web/ImageManipulatorContext.web.ts"],"sourcesContent":["import { SharedObject } from 'expo';\n\nimport ImageManipulatorImageRef from './ImageManipulatorImageRef.web';\nimport { ActionCrop, ActionExtent, FlipType } from '../ImageManipulator.types';\nimport { crop, extent, flip, resize, rotate } from './actions/index.web';\n\ntype ContextLoader = () => HTMLCanvasElement | Promise<HTMLCanvasElement>;\n\nexport default class ImageManipulatorContext extends SharedObject {\n  private loader: ContextLoader;\n  private currentTask: Promise<HTMLCanvasElement>;\n\n  constructor(loader?: ContextLoader) {\n    super();\n    this.loader = loader ?? (() => document.createElement('canvas'));\n    this.currentTask = new Promise((resolve) => resolve(this.loader()));\n  }\n\n  resize(size: { width: number; height: number }): ImageManipulatorContext {\n    return this.addTask((canvas) => resize(canvas, size));\n  }\n\n  rotate(degrees: number): ImageManipulatorContext {\n    return this.addTask((canvas) => rotate(canvas, degrees));\n  }\n\n  flip(flipType: FlipType): ImageManipulatorContext {\n    return this.addTask((canvas) => flip(canvas, flipType));\n  }\n\n  crop(rect: ActionCrop['crop']): ImageManipulatorContext {\n    return this.addTask((canvas) => crop(canvas, rect));\n  }\n\n  extent(options: ActionExtent['extent']): ImageManipulatorContext {\n    return this.addTask((canvas) => extent(canvas, options));\n  }\n\n  reset(): ImageManipulatorContext {\n    this.currentTask = new Promise((resolve) => resolve(this.loader()));\n    return this;\n  }\n\n  async renderAsync(): Promise<ImageManipulatorImageRef> {\n    const canvas = await this.currentTask;\n\n    return new Promise((resolve) => {\n      canvas.toBlob((blob) => {\n        const url = blob ? URL.createObjectURL(blob) : canvas.toDataURL();\n\n        resolve(new ImageManipulatorImageRef(url, canvas.width, canvas.height));\n      });\n    });\n  }\n\n  private addTask(\n    task: (canvas: HTMLCanvasElement) => HTMLCanvasElement | Promise<HTMLCanvasElement>\n  ): ImageManipulatorContext {\n    this.currentTask = this.currentTask.then((canvas) => {\n      return task(canvas);\n    });\n    return this;\n  }\n}\n"],"mappings":"AAAA,OAASA,YAAY,KAAQ,MAAM,CAEnC,MAAO,CAAAC,wBAAwB,KAAM,gCAAgC,CAErE,OAASC,IAAI,CAAEC,MAAM,CAAEC,IAAI,CAAEC,MAAM,CAAEC,MAAM,KAAQ,qBAAqB,CAIxE,cAAe,MAAM,CAAAC,uBAAuB,QAAS,CAAAP,YAAa,CAIhEQ,WAAWA,CAACC,MAAsB,CAAE,CAClC,KAAK,CAAC,CAAC,CACP,IAAI,CAACA,MAAM,CAAGA,MAAM,GAAK,IAAMC,QAAQ,CAACC,aAAa,CAAC,QAAQ,CAAC,CAAC,CAChE,IAAI,CAACC,WAAW,CAAG,GAAI,CAAAC,OAAO,CAAEC,OAAO,EAAKA,OAAO,CAAC,IAAI,CAACL,MAAM,CAAC,CAAC,CAAC,CAAC,CACrE,CAEAJ,MAAMA,CAACU,IAAuC,CAA2B,CACvE,MAAO,KAAI,CAACC,OAAO,CAAEC,MAAM,EAAKZ,MAAM,CAACY,MAAM,CAAEF,IAAI,CAAC,CAAC,CACvD,CAEAT,MAAMA,CAACY,OAAe,CAA2B,CAC/C,MAAO,KAAI,CAACF,OAAO,CAAEC,MAAM,EAAKX,MAAM,CAACW,MAAM,CAAEC,OAAO,CAAC,CAAC,CAC1D,CAEAd,IAAIA,CAACe,QAAkB,CAA2B,CAChD,MAAO,KAAI,CAACH,OAAO,CAAEC,MAAM,EAAKb,IAAI,CAACa,MAAM,CAAEE,QAAQ,CAAC,CAAC,CACzD,CAEAjB,IAAIA,CAACkB,IAAwB,CAA2B,CACtD,MAAO,KAAI,CAACJ,OAAO,CAAEC,MAAM,EAAKf,IAAI,CAACe,MAAM,CAAEG,IAAI,CAAC,CAAC,CACrD,CAEAjB,MAAMA,CAACkB,OAA+B,CAA2B,CAC/D,MAAO,KAAI,CAACL,OAAO,CAAEC,MAAM,EAAKd,MAAM,CAACc,MAAM,CAAEI,OAAO,CAAC,CAAC,CAC1D,CAEAC,KAAKA,CAAA,CAA4B,CAC/B,IAAI,CAACV,WAAW,CAAG,GAAI,CAAAC,OAAO,CAAEC,OAAO,EAAKA,OAAO,CAAC,IAAI,CAACL,MAAM,CAAC,CAAC,CAAC,CAAC,CACnE,MAAO,KAAI,CACb,CAEA,KAAM,CAAAc,WAAWA,CAAA,CAAsC,CACrD,KAAM,CAAAN,MAAM,CAAG,KAAM,KAAI,CAACL,WAAW,CAErC,MAAO,IAAI,CAAAC,OAAO,CAAEC,OAAO,EAAK,CAC9BG,MAAM,CAACO,MAAM,CAAEC,IAAI,EAAK,CACtB,KAAM,CAAAC,GAAG,CAAGD,IAAI,CAAGE,GAAG,CAACC,eAAe,CAACH,IAAI,CAAC,CAAGR,MAAM,CAACY,SAAS,CAAC,CAAC,CAEjEf,OAAO,CAAC,GAAI,CAAAb,wBAAwB,CAACyB,GAAG,CAAET,MAAM,CAACa,KAAK,CAAEb,MAAM,CAACc,MAAM,CAAC,CAAC,CACzE,CAAC,CAAC,CACJ,CAAC,CAAC,CACJ,CAEQf,OAAOA,CACbgB,IAAmF,CAC1D,CACzB,IAAI,CAACpB,WAAW,CAAG,IAAI,CAACA,WAAW,CAACqB,IAAI,CAAEhB,MAAM,EAAK,CACnD,MAAO,CAAAe,IAAI,CAACf,MAAM,CAAC,CACrB,CAAC,CAAC,CACF,MAAO,KAAI,CACb,CACF","ignoreList":[]},"metadata":{"hasCjsExports":false},"sourceType":"module","externalDependencies":[]}