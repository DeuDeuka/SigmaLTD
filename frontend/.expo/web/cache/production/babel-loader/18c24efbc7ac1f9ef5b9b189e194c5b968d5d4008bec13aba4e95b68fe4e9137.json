{"ast":null,"code":"import React,{useState,useEffect}from'react';import View from\"react-native-web/dist/exports/View\";import Text from\"react-native-web/dist/exports/Text\";import TextInput from\"react-native-web/dist/exports/TextInput\";import Button from\"react-native-web/dist/exports/Button\";import Alert from\"react-native-web/dist/exports/Alert\";import Keyboard from\"react-native-web/dist/exports/Keyboard\";import Vibration from\"react-native-web/dist/exports/Vibration\";import Platform from\"react-native-web/dist/exports/Platform\";import{useSelector}from'react-redux';import Database from'../database';import AsyncStorage from'@react-native-async-storage/async-storage';import{styles}from'../styles/screens/LoginScreen';import Modal from\"react-native-modal\";import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from\"react/jsx-runtime\";export default function LoginScreen({navigation}){const{current,colors}=useSelector(state=>state.theme);const theme=colors[current];const[isLogin,setIsLogin]=useState(true);const[email,setEmail]=useState('');const[password,setPassword]=useState('');const[realName,setRealName]=useState('');const[group,setGroup]=useState('');const[displayedName,setDisplayedName]=useState('');const[error,setError]=useState(null);const[showPrompt,setShowPrompt]=useState(false);useEffect(()=>{async function check(){const user=await AsyncStorage.getItem('token');if(user){navigation.replace('Main');}}check();const isIOS=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;const isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);const isStandalone=\"standalone\"in window.navigator&&window.navigator.standalone;if(isIOS&&isSafari&&!isStandalone){setShowPrompt(true);}},[]);;const handleSubmit=async()=>{setError(null);try{let user;if(isLogin){user=await Database.login({email,password});}else{if(password.length>7&&displayedName.length>1){user=await Database.register({email,password,realName,group,displayedName});}else{alert('Password or Displayed Name Too Short!');}}navigation.replace('Main');}catch(err){setError(err.message);console.error('Auth error:',err.message);}};return _jsxs(View,{style:[styles.container,{backgroundColor:theme.background}],children:[_jsx(Text,{style:[styles.title,{color:theme.text}],children:isLogin?'Login':'Sign Up'}),error&&_jsx(Text,{style:styles.error,children:error}),_jsx(TextInput,{style:[styles.input,{borderColor:theme.border,color:theme.text}],placeholder:\"Email\",value:email,onChangeText:setEmail,autoCapitalize:\"none\",placeholderTextColor:theme.text==='#000'?'#666':'#ccc'}),_jsx(TextInput,{style:[styles.input,{borderColor:theme.border,color:theme.text}],placeholder:\"Password\",value:password,onChangeText:setPassword,secureTextEntry:true,placeholderTextColor:theme.text==='#000'?'#666':'#ccc'}),!isLogin&&_jsxs(_Fragment,{children:[_jsx(TextInput,{style:[styles.input,{borderColor:theme.border,color:theme.text}],placeholder:\"Real Name\",value:realName,onChangeText:setRealName,placeholderTextColor:theme.text==='#000'?'#666':'#ccc'}),_jsx(TextInput,{style:[styles.input,{borderColor:theme.border,color:theme.text}],placeholder:\"Group (e.g., student)\",value:group,onChangeText:setGroup,placeholderTextColor:theme.text==='#000'?'#666':'#ccc'}),_jsx(TextInput,{style:[styles.input,{borderColor:theme.border,color:theme.text}],placeholder:\"Displayed Name\",value:displayedName,onChangeText:setDisplayedName,placeholderTextColor:theme.text==='#000'?'#666':'#ccc'})]}),_jsx(Button,{title:isLogin?'Login':'Sign Up',onPress:handleSubmit}),_jsx(Button,{title:`Switch to ${isLogin?'Sign Up':'Login'}`,onPress:()=>{setIsLogin(!isLogin);setError(null);setEmail('');setPassword('');setRealName('');setGroup('');setDisplayedName('');}}),_jsx(Modal,{visible:showPrompt,style:{backgroundColor:\"#111\"},children:_jsxs(View,{style:{alignItems:'center',alignSelf:'center',alignContent:'center'},children:[_jsx(Text,{style:{color:\"#fff\",fontSize:20,alignSelf:'center',alignItems:'center',alignContent:'center',justifyContent:'center'},children:\"\\u041D\\u0430\\u0436\\u043C\\u0438 \\u043D\\u0430 \\u043A\\u043D\\u043E\\u043F\\u043A\\u0443 \\u043F\\u043E\\u0434\\u0435\\u043B\\u0438\\u0442\\u044C\\u0441\\u044F, \\u043F\\u043E\\u0442\\u043E\\u043C \\u0432\\u044B\\u0431\\u0435\\u0440\\u0438 \\\"Add to Home Screen\\\" \\u0447\\u0442\\u043E\\u0431\\u044B \\u0443\\u0441\\u0442\\u0430\\u043D\\u043E\\u0432\\u0438\\u0442\\u044C\"}),_jsx(Button,{title:\"Got it\",onPress:()=>setShowPrompt(false)})]})})]});}","map":{"version":3,"names":["React","useState","useEffect","View","Text","TextInput","Button","Alert","Keyboard","Vibration","Platform","useSelector","Database","AsyncStorage","styles","Modal","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","LoginScreen","navigation","current","colors","state","theme","isLogin","setIsLogin","email","setEmail","password","setPassword","realName","setRealName","group","setGroup","displayedName","setDisplayedName","error","setError","showPrompt","setShowPrompt","check","user","getItem","replace","isIOS","test","navigator","userAgent","window","MSStream","isSafari","isStandalone","standalone","handleSubmit","login","length","register","alert","err","message","console","style","container","backgroundColor","background","children","title","color","text","input","borderColor","border","placeholder","value","onChangeText","autoCapitalize","placeholderTextColor","secureTextEntry","onPress","visible","alignItems","alignSelf","alignContent","fontSize","justifyContent"],"sources":["/Users/deu/SigmaLTD/frontend/screens/LoginScreen.js"],"sourcesContent":["// screens/LoginScreen.js\n\nimport React, {useState, useEffect} from 'react';\nimport {View, Text, TextInput, Button, Alert, Keyboard, Vibration, Platform} from 'react-native'; // Ensure StyleSheet is included\nimport {useSelector} from 'react-redux';\nimport Database from '../database';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport {styles} from '../styles/screens/LoginScreen';\nimport Modal from \"react-native-modal\";\n\nexport default function LoginScreen({navigation}) {\n    const {current, colors} = useSelector((state) => state.theme);\n    const theme = colors[current];\n    const [isLogin, setIsLogin] = useState(true);\n    const [email, setEmail] = useState('');\n    const [password, setPassword] = useState('');\n    const [realName, setRealName] = useState('');\n    const [group, setGroup] = useState('');\n    const [displayedName, setDisplayedName] = useState('');\n    const [error, setError] = useState(null);\n    const [showPrompt, setShowPrompt] = useState(false);\n\n    useEffect(() => {\n        async function check() {\n            const user = await AsyncStorage.getItem('token');\n            if (user) {\n                navigation.replace('Main');\n            }\n        }\n\n        check();\n        // Check if running on iOS in a browser (not standalone mode)\n        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;\n        const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n        const isStandalone = \"standalone\" in window.navigator && window.navigator.standalone;\n\n        if (isIOS && isSafari && !isStandalone) {\n            setShowPrompt(true);\n        }\n    }, []);\n    ;\n    const handleSubmit = async () => {\n        setError(null);\n        try {\n            let user;\n            if (isLogin) {\n                user = await Database.login({email, password});\n            } else {\n                if ((password.length > 7) && (displayedName.length > 1)) {\n                    user = await Database.register({email, password, realName, group, displayedName});\n                } else {\n                    alert('Password or Displayed Name Too Short!');\n                }\n            }\n            navigation.replace('Main');\n        } catch (err) {\n            setError(err.message);\n            console.error('Auth error:', err.message);\n        }\n    };\n\n\n    return (\n        <View style={[styles.container, {backgroundColor: theme.background}]}>\n            <Text style={[styles.title, {color: theme.text}]}>\n                {isLogin ? 'Login' : 'Sign Up'}\n            </Text>\n            {error && <Text style={styles.error}>{error}</Text>}\n            <TextInput\n                style={[styles.input, {borderColor: theme.border, color: theme.text}]}\n                placeholder=\"Email\"\n                value={email}\n                onChangeText={setEmail}\n                autoCapitalize=\"none\"\n                placeholderTextColor={theme.text === '#000' ? '#666' : '#ccc'}\n            />\n            <TextInput\n                style={[styles.input, {borderColor: theme.border, color: theme.text}]}\n                placeholder=\"Password\"\n                value={password}\n                onChangeText={setPassword}\n                secureTextEntry\n                placeholderTextColor={theme.text === '#000' ? '#666' : '#ccc'}\n            />\n            {!isLogin && (\n                <>\n                    <TextInput\n                        style={[styles.input, {borderColor: theme.border, color: theme.text}]}\n                        placeholder=\"Real Name\"\n                        value={realName}\n                        onChangeText={setRealName}\n                        placeholderTextColor={theme.text === '#000' ? '#666' : '#ccc'}\n                    />\n                    <TextInput\n                        style={[styles.input, {borderColor: theme.border, color: theme.text}]}\n                        placeholder=\"Group (e.g., student)\"\n                        value={group}\n                        onChangeText={setGroup}\n                        placeholderTextColor={theme.text === '#000' ? '#666' : '#ccc'}\n                    />\n                    <TextInput\n                        style={[styles.input, {borderColor: theme.border, color: theme.text}]}\n                        placeholder=\"Displayed Name\"\n                        value={displayedName}\n                        onChangeText={setDisplayedName}\n                        placeholderTextColor={theme.text === '#000' ? '#666' : '#ccc'}\n                    />\n                </>\n            )}\n            <Button title={isLogin ? 'Login' : 'Sign Up'} onPress={handleSubmit}/>\n            <Button\n                title={`Switch to ${isLogin ? 'Sign Up' : 'Login'}`}\n                onPress={() => {\n                    setIsLogin(!isLogin);\n                    setError(null);\n                    setEmail('');\n                    setPassword('');\n                    setRealName('');\n                    setGroup('');\n                    setDisplayedName('');\n                }}\n            />\n            <Modal visible={showPrompt} style={{backgroundColor: \"#111\"}}>\n                <View style={{alignItems: 'center', alignSelf: 'center', alignContent: 'center'}}>\n                    <Text style={{color: \"#fff\", fontSize: 20, alignSelf: 'center', alignItems: 'center', alignContent: 'center', justifyContent: 'center'}}>\n                        Нажми на кнопку поделиться, потом выбери \"Add to Home Screen\" чтобы установить\n                    </Text>\n                    {/* Add an image or icon here */}\n                    <Button title=\"Got it\" onPress={() => setShowPrompt(false)} />\n                </View>\n            </Modal>\n        </View>\n    );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{"hasCjsExports":false},"sourceType":"module","externalDependencies":[]}