{"ast":null,"code":"import React,{forwardRef}from'react';import View from\"react-native-web/dist/exports/View\";import FlatList from\"react-native-web/dist/exports/FlatList\";import Text from\"react-native-web/dist/exports/Text\";import Dimensions from\"react-native-web/dist/exports/Dimensions\";import SafeAreaView from\"react-native-web/dist/exports/SafeAreaView\";import{styles}from'../styles/screens/FeedScreen';import{FloatingButton}from'../components/FloatingButton';import Database from'../database';import Post from'../components/Post';import AsyncStorage from\"@react-native-async-storage/async-storage\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const FeedScreen=forwardRef((props,ref)=>{class FeedScreenClass extends React.Component{constructor(props){super(props);this.state={data:[],page:1,isLoading:false,hasMore:true,navigation:props.navigation,currentScreen:props.currentScreen};this.flatListRef=React.createRef();}componentDidMount(){this.fetchData();}fetchData=async()=>{if(this.state.isLoading||!this.state.hasMore)return;this.setState({isLoading:true});try{const res=await Database.getAllPosts(this.state.page);const newPosts=res.posts||[];this.setState(prevState=>({data:prevState.page===1?newPosts:[...prevState.data,...newPosts],isLoading:false,hasMore:newPosts.length>0}));}catch(error){console.error('Error fetching posts:',error);if(error.message===\"{\\\"error\\\":\\\"Access denied, no valid Bearer token provided\\\"}\"){this.state.navigation.navigate('Login');await AsyncStorage.removeItem('token');}this.setState({isLoading:false});}};handleLoadMore=()=>{if(!this.state.isLoading&&this.state.hasMore){this.setState(prevState=>({page:prevState.page+1}),()=>this.fetchData());}};handleScroll=event=>{const{contentOffset,contentSize,layoutMeasurement}=event.nativeEvent;const distanceFromBottom=contentSize.height-contentOffset.y-layoutMeasurement.height;};renderRow=({item})=>{return _jsxs(View,{style:{minHeight:50},children:[\" \",_jsx(Post,{post:item,navigation:this.props.navigation,currentScreen:this.props.currentScreen})]});};renderList=()=>{return _jsx(FlatList,{ref:this.flatListRef,data:this.state.data,renderItem:this.renderRow,keyExtractor:(item,index)=>item.id?item.id.toString():index.toString(),onEndReached:this.handleLoadMore,onEndReachedThreshold:0.1,style:{backgroundColor:\"#000\",flex:1,alignSelf:'center'},onScroll:this.handleScroll,ListFooterComponent:this.renderFooter,showsVerticalScrollIndicator:false,contentContainerStyle:{flexGrow:1},extraData:this.state.page});};renderFooter=()=>{if(!this.state.isLoading)return null;return _jsx(View,{style:{padding:20},children:_jsx(Text,{children:\"Loading more posts...\"})});};renderEmpty=()=>{if(this.state.isLoading)return null;return _jsx(View,{style:{flex:1,justifyContent:'center',alignItems:'center'},children:_jsx(Text,{children:\"No posts available\"})});};render(){const{navigation}=this.props;return _jsxs(SafeAreaView,{style:[styles.container,{backgroundColor:\"#000\"}],children:[this.state.data.length===0?this.renderEmpty():this.renderList(),_jsx(FloatingButton,{onPress:()=>navigation.navigate('CreatePost'),visible:true})]});}}const FeedScreenInstance=React.createRef();React.useImperativeHandle(ref,()=>({fetchData:()=>FeedScreenInstance.current?.fetchData(),listRef:FeedScreenInstance.current?.flatListRef}));return _jsx(FeedScreenClass,Object.assign({ref:FeedScreenInstance},props));});export default FeedScreen;","map":{"version":3,"names":["React","forwardRef","View","FlatList","Text","Dimensions","SafeAreaView","styles","FloatingButton","Database","Post","AsyncStorage","jsx","_jsx","jsxs","_jsxs","FeedScreen","props","ref","FeedScreenClass","Component","constructor","state","data","page","isLoading","hasMore","navigation","currentScreen","flatListRef","createRef","componentDidMount","fetchData","setState","res","getAllPosts","newPosts","posts","prevState","length","error","console","message","navigate","removeItem","handleLoadMore","handleScroll","event","contentOffset","contentSize","layoutMeasurement","nativeEvent","distanceFromBottom","height","y","renderRow","item","style","minHeight","children","post","renderList","renderItem","keyExtractor","index","id","toString","onEndReached","onEndReachedThreshold","backgroundColor","flex","alignSelf","onScroll","ListFooterComponent","renderFooter","showsVerticalScrollIndicator","contentContainerStyle","flexGrow","extraData","padding","renderEmpty","justifyContent","alignItems","render","container","onPress","visible","FeedScreenInstance","useImperativeHandle","current","listRef","Object","assign"],"sources":["/Users/deu/SigmaLTD/screens/FeedScreen.js"],"sourcesContent":["import React, {forwardRef} from 'react';\nimport {\n    View,\n    FlatList,\n    Text,\n    Dimensions, SafeAreaView,\n} from 'react-native';\nimport {styles} from '../styles/screens/FeedScreen';\nimport {FloatingButton} from '../components/FloatingButton';\nimport Database from '../database';\nimport Post from '../components/Post';\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\n\n\nconst FeedScreen = forwardRef((props, ref) => {\n    class FeedScreenClass extends React.Component {\n        constructor(props) {\n            super(props);\n            this.state = {\n                data: [],\n                page: 1,\n                isLoading: false,\n                hasMore: true,\n                navigation: props.navigation,\n                currentScreen: props.currentScreen,\n            };\n            this.flatListRef = React.createRef();\n        }\n\n        componentDidMount() {\n            this.fetchData();\n        }\n\n        fetchData = async () => {\n            if (this.state.isLoading || !this.state.hasMore) return;\n\n            this.setState({ isLoading: true });\n            try {\n                const res = await Database.getAllPosts(this.state.page);\n                const newPosts = res.posts || [];\n\n                this.setState(prevState => ({\n                    data: prevState.page === 1 ? newPosts : [...prevState.data, ...newPosts],\n                    isLoading: false,\n                    hasMore: newPosts.length > 0\n                }));\n            } catch (error) {\n                console.error('Error fetching posts:', error);\n                if (error.message === \"{\\\"error\\\":\\\"Access denied, no valid Bearer token provided\\\"}\") {\n                    this.state.navigation.navigate('Login');\n                    await AsyncStorage.removeItem('token');\n                }\n                this.setState({ isLoading: false });\n            }\n        };\n\n        handleLoadMore = () => {\n            if (!this.state.isLoading && this.state.hasMore) {\n                this.setState(\n                    prevState => ({ page: prevState.page + 1 }),\n                    () => this.fetchData()\n                );\n            }\n        };\n\n        // Add this to debug scroll position\n        handleScroll = (event) => {\n            const { contentOffset, contentSize, layoutMeasurement } = event.nativeEvent;\n            const distanceFromBottom = contentSize.height - contentOffset.y - layoutMeasurement.height;\n        };\n\n        renderRow = ({ item }) => {\n            return (\n                <View style={{ minHeight: 50 }}> {/* Ensure items have minimum height */}\n                    <Post post={item} navigation={this.props.navigation} currentScreen={this.props.currentScreen} />\n                </View>\n            );\n        };\n\n        renderList = () => {\n            return (\n                <FlatList\n                    ref={this.flatListRef}\n                    data={this.state.data}\n                    renderItem={this.renderRow}\n                    keyExtractor={(item, index) => item.id ? item.id.toString() : index.toString()}\n                    onEndReached={this.handleLoadMore}\n                    onEndReachedThreshold={0.1}\n                    style={{ backgroundColor: \"#000\", flex: 1, alignSelf: 'center' }}\n                    onScroll={this.handleScroll} // Add scroll debugging\n                    ListFooterComponent={this.renderFooter}\n                    showsVerticalScrollIndicator={false} // Make scroll indicator visible for debugging\n                    contentContainerStyle={{ flexGrow: 1 }} // Ensure content takes up space\n                    extraData={this.state.page} // Force re-render on page change\n                />\n            );\n        };\n\n        renderFooter = () => {\n            if (!this.state.isLoading) return null;\n            return (\n                <View style={{ padding: 20 }}>\n                    <Text>Loading more posts...</Text>\n                </View>\n            );\n        };\n\n        renderEmpty = () => {\n            if (this.state.isLoading) return null;\n            return (\n                <View style={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}>\n                    <Text>No posts available</Text>\n                </View>\n            );\n        };\n\n        render() {\n            const { navigation } = this.props;\n            return (\n                <SafeAreaView style={[styles.container, { backgroundColor: \"#000\" }]}>\n                    {this.state.data.length === 0 ? this.renderEmpty() : this.renderList()}\n                    <FloatingButton\n                        onPress={() => navigation.navigate('CreatePost')}\n                        visible={true}\n                    />\n                </SafeAreaView>\n            );\n        }\n    }\n    const FeedScreenInstance = React.createRef();\n    React.useImperativeHandle(ref, () => ({\n        fetchData: () => FeedScreenInstance.current?.fetchData(),\n        listRef: FeedScreenInstance.current?.flatListRef,\n    }));\n\n    return <FeedScreenClass ref={FeedScreenInstance} {...props} />;\n})\nexport default FeedScreen;"],"mappings":"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","ignoreList":[]},"metadata":{"hasCjsExports":false},"sourceType":"module","externalDependencies":[]}